WITH TESTE AS (
SELECT
	DI.DOCUMENTO_DOCITEM,
	I.CODIGO_ITEM AS CODIGO,
	I.DESCRICAO_ITEM AS NOME_ITEM,
	C.DESCRICAO_COR AS NOME_COR,
	A.DESCRICAO_ACABAMENTO AS NOME_ACABAMENTO,
	SUM(DID.QTDEFATURADO_DOCITEMDET) AS QUANTIDADE,
	(DID.QTDEFATURADO_DOCITEMDET * DID.VLRUNITARIOLIQUIDO_DOCITEMDET) AS TOTAL_VENDIDO
FROM NOTA_FISCAL NF
	INNER JOIN DOCUMENTO_ITEM DI ON DI.DOCUMENTO_DOCITEM = NF.LISTA_PEDIDOS_NF AND NF.LISTA_PEDIDOS_NF NOT LIKE '%/%'
	INNER JOIN DOCUMENTO_FATURA DF ON DF.CODIGO_DOCFAT = DI.DOCUMENTO_DOCITEM
	INNER JOIN ITEM I ON I.CODIGO_ITEM = DI.ITEM_DOCITEM
	INNER JOIN DOCUMENTO_ITEM_DETALHE DID ON DID.DOCUMENTO_DOCITEMDET = DI.DOCUMENTO_DOCITEM AND DID.AUTOINCITEM_DOCITEMDET = DI.AUTOINC_DOCITEM
	INNER JOIN COR C ON C.CODIGO_COR = DID.COR_DOCITEMDET
	INNER JOIN ACABAMENTO A ON A.CODIGO_ACABAMENTO = DID.ACABAMENTO_DOCITEMDET
WHERE
	CAST(DF.DTEMISSAO_DOCFAT AS DATE) BETWEEN '2025-01-01' AND '2025-01-30' AND
	NF.TRANSACAO_NF IN (2,20,110,119,121,350) AND
    DF.CLASSIFICACAO_DOCFAT = 1
GROUP BY
	DI.DOCUMENTO_DOCITEM,
	C.DESCRICAO_COR,
	A.DESCRICAO_ACABAMENTO,
	I.CODIGO_ITEM,
	I.DESCRICAO_ITEM,
	TOTAL_VENDIDO 
ORDER BY TOTAL_VENDIDO DESC
)
SELECT
SUM(TOTAL_VENDIDO) AS VENDIDO
FROM TESTE;

SELECT * FROM DOCUMENTO_ITEM;
